/*********************************************************************************************************************
 * @file        encoder.h
 * @brief       飞檐走壁智能车 - 编码器模块 (头文件)
 * @details     龙邱6线编码器 - 脉冲+方向模式 (非正交解码)
 * @author      智能车竞赛代码
 * @version     1.0
 * @date        2026-02-01
 * 
 * @note        编码器工作模式:
 *              - A相: 输出脉冲 (每转N个脉冲)
 *              - DIR相: 输出方向 (高/低电平代表正反转)
 *              - 不是AB正交解码, 使用定时器计数器模式
 ********************************************************************************************************************/

#ifndef __ENCODER_H__
#define __ENCODER_H__

#include "car_config.h"

/*==================================================================================================================
 *                                              编码器数据结构体
 *==================================================================================================================*/

/**
 * @brief   编码器数据结构体
 */
typedef struct
{
    int16 left_count;       // 左编码器计数值 (带方向)
    int16 right_count;      // 右编码器计数值 (带方向)
    int16 left_speed;       // 左轮速度 (脉冲数/周期)
    int16 right_speed;      // 右轮速度 (脉冲数/周期)
} EncoderData_t;

// 全局编码器数据实例
extern EncoderData_t g_encoder;

/*==================================================================================================================
 *                                              函数声明
 *==================================================================================================================*/

/**
 * @brief   初始化编码器模块
 * @details 初始化左右编码器的计数器和方向引脚
 * @return  void
 */
void Encoder_Init(void);

/**
 * @brief   更新编码器数据
 * @details 读取计数值, 结合方向引脚计算带符号速度, 然后清零计数器
 *          应在固定周期 (如5ms) 的定时中断中调用
 * @return  void
 */
void Encoder_Update(void);

/**
 * @brief   获取左轮速度
 * @return  int16   左轮速度 (脉冲数/周期, 带方向)
 */
int16 Encoder_GetLeftSpeed(void);

/**
 * @brief   获取右轮速度
 * @return  int16   右轮速度 (脉冲数/周期, 带方向)
 */
int16 Encoder_GetRightSpeed(void);

/**
 * @brief   获取平均速度
 * @return  int16   (左速度 + 右速度) / 2
 */
int16 Encoder_GetAverageSpeed(void);

/**
 * @brief   清零编码器计数
 * @return  void
 */
void Encoder_Clear(void);

#endif // __ENCODER_H__
