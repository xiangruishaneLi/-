/*********************************************************************************************************************
 * @file        main.c
 * @brief       飞檐走壁智能车 - 主程序入口
 * @details     第21届全国大学生智能车竞赛 - 飞檐走壁组
 * @author      智能车竞赛代码
 * @version     1.0
 * @date        2026-02-01
 * 
 * @note        基于逐飞科技 STC32G12K128 开源库开发
 ********************************************************************************************************************/

#include "zf_common_headfile.h"

// 引入项目代码模块
#include "../code/system.h"

/*==================================================================================================================
 *                                              主函数
 *==================================================================================================================*/

void main()
{
    /*-------------------------------------------------
     * Step 1: 关闭全局中断 (初始化期间)
     *-------------------------------------------------*/
    interrupt_global_disable();
    
    /*-------------------------------------------------
     * Step 2: 系统时钟初始化 (30MHz)
     *-------------------------------------------------*/
    clock_init(SYSTEM_CLOCK_30M);
    
    /*-------------------------------------------------
     * Step 3: 调试串口初始化
     *-------------------------------------------------*/
    debug_init();
    
    /*-------------------------------------------------
     * Step 4: 系统初始化 (所有外设)
     *-------------------------------------------------*/
    System_Init();
    
    /*-------------------------------------------------
     * Step 5: 开启全局中断
     *-------------------------------------------------*/
    interrupt_global_enable();
    
    /*-------------------------------------------------
     * Step 6: 主循环
     *-------------------------------------------------*/
    while(1)
    {
        // 执行非实时任务:
        // - 蓝牙命令处理
        // - 电池检测
        // - OLED 显示更新
        System_TaskLoop();
        
        // 适当延时, 降低CPU占用
        system_delay_ms(5);
    }
}
