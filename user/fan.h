/*********************************************************************************************************************
 * @file        fan.h
 * @brief       飞檐走壁智能车 - 负压风扇控制模块 (头文件)
 * @details     PWM 控制吸附风扇, 支持 IMU 姿态自适应
 * @author      智能车竞赛代码
 * @version     1.0
 * @date        2026-02-01
 * 
 * @note        上墙时根据 IMU 俯仰角自动增大吸力
 *              地面模式: 默认占空比 (省电)
 *              上墙模式: 高占空比 (强吸附)
 ********************************************************************************************************************/

#ifndef __FAN_H__
#define __FAN_H__

#include "car_config.h"

/*==================================================================================================================
 *                                              风扇模式枚举
 *==================================================================================================================*/

typedef enum
{
    FAN_MODE_OFF = 0,       // 关闭
    FAN_MODE_GROUND,        // 地面模式 (低吸力)
    FAN_MODE_WALL,          // 上墙模式 (高吸力)
    FAN_MODE_AUTO           // 自动模式 (根据IMU自适应)
} FanMode_t;

/*==================================================================================================================
 *                                              函数声明
 *==================================================================================================================*/

/**
 * @brief   初始化风扇模块
 * @return  void
 */
void Fan_Init(void);

/**
 * @brief   设置风扇占空比
 * @param   duty    占空比 (0 ~ 10000, 对应 0% ~ 100%)
 * @return  void
 */
void Fan_SetDuty(uint16 duty);

/**
 * @brief   设置风扇模式
 * @param   mode    风扇模式枚举
 * @return  void
 */
void Fan_SetMode(FanMode_t mode);

/**
 * @brief   获取当前风扇占空比
 * @return  uint16  当前占空比
 */
uint16 Fan_GetDuty(void);

/**
 * @brief   风扇自适应控制 (根据IMU俯仰角)
 * @param   pitch_angle     俯仰角 (度, 正值=抬头, 负值=低头)
 * @return  void
 * @note    适用于 FAN_MODE_AUTO 模式
 *          俯仰角越大, 占空比越高
 */
void Fan_AutoAdjust(int16 pitch_angle);

/**
 * @brief   风扇紧急停止
 * @return  void
 */
void Fan_Stop(void);

#endif // __FAN_H__
