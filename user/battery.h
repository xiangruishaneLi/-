/*********************************************************************************************************************
 * @file        battery.h
 * @brief       飞檐走壁智能车 - 电池监测模块 (头文件)
 * @details     电压采样与低压保护
 * @author      智能车竞赛代码
 * @version     1.0
 * @date        2026-02-01
 * 
 * @note        电路: 电阻分压 (200k + 20k) + 100nF滤波
 *              分压比: 20 / (200 + 20) = 1/11
 *              计算: 实际电压 = ADC电压 × 11
 ********************************************************************************************************************/

#ifndef __BATTERY_H__
#define __BATTERY_H__

#include "car_config.h"

/*==================================================================================================================
 *                                              电池状态枚举
 *==================================================================================================================*/

typedef enum
{
    BATTERY_OK = 0,         // 电池正常
    BATTERY_LOW,            // 低电压警告 (<11.0V)
    BATTERY_CRITICAL        // 严重低电压 (<10.5V)
} BatteryStatus_t;

/*==================================================================================================================
 *                                              函数声明
 *==================================================================================================================*/

/**
 * @brief   初始化电池监测模块
 * @return  void
 */
void Battery_Init(void);

/**
 * @brief   获取电池电压
 * @return  float   实际电池电压 (V)
 */
float Battery_GetVoltage(void);

/**
 * @brief   获取电池状态
 * @return  BatteryStatus_t   电池状态枚举
 */
BatteryStatus_t Battery_GetStatus(void);

/**
 * @brief   电池检测任务 (周期调用)
 * @details 检测电压, 低于阈值时蜂鸣器报警
 *          严重低电压时停机保护
 * @return  void
 * @note    建议每100ms调用一次
 */
void Battery_Check(void);

/**
 * @brief   蜂鸣器报警 (用于低电压警告)
 * @param   pattern     报警模式 (0=停止, 1=慢闪, 2=快闪)
 * @return  void
 */
void Battery_AlarmBuzzer(uint8 pattern);

#endif // __BATTERY_H__
